# 2026-02-25 - TapSpot 开发日志

## 完成功能

### 1. Bug 修复
- ✅ 修复帖子搜索 API 返回 `null` 导致前端白屏 → 改为返回 `[]`
- ✅ 修复用户搜索逻辑 → 只搜索昵称，不搜索用户名
- ✅ 所有列表 API 统一返回空数组 `[]` 而不是 `null`

### 2. 用户注册 IP 记录
- ✅ User 模型新增 `registration_ip` 字段
- ✅ 注册时自动记录用户 IP 地址
- ✅ 支持 `X-Real-IP` 和 `X-Forwarded-For` 头
- ✅ 用户统计 API: `GET /api/users/stats`
  - 总用户数、每日增长统计
  - IP 分布统计（检测自然增量）
  - 自然增长用户数（单 IP 单用户）

### 3. 访客统计系统
- ✅ 新增 `Visit` 模型记录访问信息
- ✅ 自动记录 IP、User-Agent、访问路径、时间
- ✅ 区分登录用户和游客
- ✅ 跳过静态资源（CSS/JS/图片）
- ✅ 访客统计 API:
  - `GET /api/stats/visits` - 访客统计（总访问量、独立 IP、每日统计、热门页面、IP 分布）
  - `GET /api/stats/realtime` - 实时在线访客（最近 5 分钟）

### 4. AI 位置分析
- ✅ AI 分析 API: `POST /api/ai/analyze`
- ✅ 使用阿里云百炼 Qwen3-Coder-Plus 模型
- ✅ API 端点：`https://coding.dashscope.aliyuncs.com/v1`
- ✅ 分析文案不超过 80 字，生动有趣带 emoji
- ✅ AI 助手 UI 组件（frontend/src/components/AIAssistant.jsx）
  - 地图右下角活泼 AI 形象
  - 自动跳动动画吸引注意
  - 分析时显示思考表情 🤔 + ⚡
  - 完成后显示兴奋表情 ✨
  - 气泡展示分析结果

## 技术细节

### 服务器配置
- 服务器：43.135.148.74
- 后端：port 8080
- 前端：nginx 托管
- 数据库：MySQL + GORM

### 代码结构
- 按业务逻辑分层：dto/ services/ middleware/ controllers/
- 文档整合到 README.md（不单独建 docs 文件夹）

### API Key 配置
- 阿里云百炼 API Key: `sk-sp-58397f71c3304b03879e04efd48f9e4b`
- 配置在 `backend/.env` 环境变量

### 测试账号
- 管理员：root / root
- 用户：wth2066272 / wth2066272（昵称：吴生）

## 自然增量分析逻辑
- 单 IP 单用户 = 自然增长（真实用户）
- 单 IP 多用户 = 可能刷量
- 结合用户注册 IP + 访问 IP 进行更准确分析

## Git 提交
- commit: 91625915
- 仓库：https://github.com/codedancewth/TapSpot
